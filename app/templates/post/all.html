{% extends 'main/base.html' %}

{% block title %}All themes{% endblock %}

{% block style %}
<link rel="stylesheet" href="{{url_for('static', filename='css/libs/all.min.css') }}">
<link rel="stylesheet" href="{{url_for('static', filename='css/themes.css') }}">
{% endblock %}

{% block content %}
<form method="post" class="form-control d-flex flex-row gap-2" id="teacherForm">
    {{ form.csrf_token }}
    {{ form.teacher }}
    {{ form.discipline_filter }}
    {{ form.group_filter }}
    <div class="form-check ms-2">
        {{ form.show_checked }}
        <label class="form-check-label">
            Only checked
        </label>
    </div>
    <input type="submit" class="btn btn-success" value="Show">
</form>

<div class="w-100 mt-4">
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead>
            <tr>
                <th scope="col">Teacher</th>
                <th scope="col">Theme</th>
                <th scope="col">Course</th>
                <th scope="col">Group</th>
                <th scope="col">Student</th>
                <th scope="col">Deadline</th>
                <th scope="col">Status</th>
                <th scope="col">Comments</th>
                {% if current_user.is_authenticated %}
                <th scope="col">Actions</th>
                {% endif %}
            </tr>
            </thead>
            <tbody>
            {% for post in posts %}
            <tr>
                <td data-label="Teacher">
                    <div class="teacher-name">
                        <img src="{% if post.author.avatar %}{{ url_for('static', filename='upload/' + post.author.avatar) }}{% else %}{{ url_for('static', filename='img/default.jpg') }}{% endif %}"
                             alt="Teacher" class="avatar">
                        {{ post.author.name }}
                    </div>
                </td>
                <td data-label="Theme">{{ post.subject }}</td>
                <td data-label="Course">{{ post.discipline }}</td>
                <td data-label="Group">{{ post.group_number }}</td>
                <td data-label="Student">
                    {% with student = user.query.get(post.student) %}
                    <div class="student-name">
                        <img src="{% if student.avatar %}{{ url_for('static', filename='upload/' + student.avatar) }}{% else %}{{ url_for('static', filename='img/default.jpg') }}{% endif %}"
                             alt="Student" class="avatar">
                        {{ student.name }}
                    </div>
                    {% endwith %}
                </td>
                <td data-label="Deadline">
                    {% if post.deadline %}
                    {{ post.deadline.strftime('%Y-%m-%d') }}
                    {% if post.is_deadline_passed() %}
                    <span class="badge bg-danger">Overdue</span>
                    {% endif %}
                    {% else %}
                    No deadline
                    {% endif %}
                </td>


                <td data-label="Status">
                    {% if post.is_checked %}
                    <span class="badge bg-success">checked</span>
                    {% else %}
                    <span class="badge bg-warning text-dark">pending</span>
                    {% endif %}
                </td>
                <td data-label="Comments">
                    {% if post.comment %}
                    {{ post.comment|truncate(50) }}
                    {% if post.comment|length > 50 %}
                    <button class="btn btn-sm btn-link" data-bs-toggle="modal"
                            data-bs-target="#commentsModal{{ post.id }}">
                        Read more
                    </button>
                    {% endif %}
                    {% else %}
                    No comments
                    {% endif %}

                    <!-- Modal for full comments -->
                    {% for post in posts %}
                    <!-- Модальное окно для комментария -->
                    <div class="modal fade" id="commentsModal{{ post.id }}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Full comment</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    {{ post.comment }}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </td>

                {% if current_user.is_authenticated and post.author.id == current_user.id %}
                <td data-label="Actions">
                    <a href="{{ url_for('post.update', id=post.id) }}" class="btn btn-secondary btn-sm">
                        <i class="fa-solid fa-pen-to-square"></i> Change
                    </a>
                    <a href="{{ url_for('post.delete', id=post.id) }}" class="btn btn-danger btn-sm">
                        <i class="fa-solid fa-trash"></i> Delete
                    </a>
                </td>
                {% elif current_user.is_authenticated %}
                <td data-label="Actions"></td>
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}